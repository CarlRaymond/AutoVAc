Version 4
SHEET 1 2052 736
WIRE 112 64 96 64
WIRE 512 64 496 64
WIRE 656 64 640 64
WIRE 896 64 880 64
WIRE 496 80 496 64
WIRE 640 80 640 64
WIRE 672 80 640 80
WIRE 96 96 96 64
WIRE 128 96 96 96
WIRE -544 112 -576 112
WIRE -512 112 -544 112
WIRE -384 128 -400 128
WIRE -576 144 -576 112
WIRE -512 144 -512 112
WIRE -400 144 -400 128
WIRE 464 160 448 160
WIRE 736 160 720 160
WIRE 880 160 880 64
WIRE -224 176 -240 176
WIRE 448 176 448 160
WIRE 496 176 496 160
WIRE 496 176 448 176
WIRE 560 176 496 176
WIRE 640 176 640 80
WIRE -240 208 -240 176
WIRE -240 208 -304 208
WIRE -176 208 -240 208
WIRE -128 208 -176 208
WIRE 16 208 -128 208
WIRE 96 208 96 96
WIRE 176 208 160 208
WIRE 272 208 256 208
WIRE 384 208 368 208
WIRE 720 208 720 160
WIRE 720 208 688 208
WIRE 736 208 720 208
WIRE -128 224 -128 208
WIRE -576 240 -576 224
WIRE -544 240 -576 240
WIRE -512 240 -512 224
WIRE -512 240 -544 240
WIRE -400 240 -400 224
WIRE 160 240 160 208
WIRE 160 240 144 240
WIRE 176 240 160 240
WIRE 256 240 256 208
WIRE 256 240 240 240
WIRE 272 240 256 240
WIRE 368 240 368 208
WIRE 368 240 352 240
WIRE 432 240 368 240
WIRE 560 240 432 240
WIRE -544 256 -544 240
WIRE 640 256 640 240
WIRE -304 272 -304 208
WIRE -240 272 -240 208
WIRE 16 272 -16 272
WIRE 368 272 368 240
WIRE 432 272 432 240
WIRE 880 272 880 256
WIRE 96 304 96 272
WIRE -368 320 -384 320
WIRE -512 336 -576 336
WIRE -384 336 -384 320
WIRE 496 336 496 176
WIRE 560 336 496 336
WIRE 720 336 720 208
WIRE 720 336 640 336
WIRE -576 352 -576 336
WIRE -512 352 -512 336
WIRE -176 352 -176 208
WIRE -16 352 -16 272
WIRE 32 352 -16 352
WIRE 160 352 96 352
WIRE 256 352 256 240
WIRE 256 352 160 352
WIRE 880 352 880 336
WIRE 496 368 496 336
WIRE 368 384 368 336
WIRE 400 384 368 384
WIRE 432 384 432 352
WIRE 432 384 400 384
WIRE -416 400 -432 400
WIRE -432 432 -432 400
WIRE -416 432 -432 432
WIRE -384 432 -384 416
WIRE -384 432 -416 432
WIRE -304 432 -304 352
WIRE -304 432 -384 432
WIRE -240 432 -240 352
WIRE -240 432 -304 432
WIRE -176 432 -176 416
WIRE -176 432 -240 432
WIRE -128 432 -128 288
WIRE -128 432 -176 432
WIRE -112 432 -128 432
WIRE -16 432 -16 352
WIRE -16 432 -32 432
WIRE 32 432 -16 432
WIRE 160 432 160 352
WIRE 160 432 112 432
WIRE -576 448 -576 432
WIRE -544 448 -576 448
WIRE -512 448 -512 432
WIRE -512 448 -544 448
WIRE 880 448 880 432
WIRE -544 464 -544 448
WIRE -416 464 -416 432
WIRE 400 464 400 384
WIRE 496 464 496 448
FLAG -400 240 0
FLAG 96 304 0
FLAG 640 256 0
FLAG 720 160 Vout
FLAG -400 128 Vcc
FLAG 496 64 Vcc
FLAG 640 64 Vcc
FLAG 448 160 Vcomp
FLAG 368 208 Vcap
FLAG -544 256 0
FLAG -544 112 Vswitch
FLAG -544 464 0
FLAG -240 176 Vsense
FLAG 96 64 Vcc
FLAG 496 464 0
FLAG 400 464 0
FLAG -304 496 0
FLAG -384 496 0
FLAG -384 320 Vcc
FLAG -432 400 Vref
FLAG 160 208 Vamp
FLAG 256 208 Vdiode
FLAG 128 160 0
FLAG 672 144 0
FLAG 880 64 Vcc
FLAG 880 448 0
SYMBOL res -256 256 R0
SYMATTR InstName R1
SYMATTR Value 10
SYMBOL MCP6001 16 240 R0
WINDOW 3 6 -114 Top 2
SYMATTR InstName U1
SYMBOL voltage -400 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 -78 -33 Left 2
SYMATTR SpiceLine Rser=.2 Cpar=10u
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL res -16 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res 128 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100K
SYMBOL MCP6001 560 208 R0
WINDOW 3 15 -134 Top 2
SYMATTR InstName U2
SYMBOL polcap 352 272 R0
WINDOW 3 24 56 Left 2
SYMATTR Value 100µ
SYMATTR InstName C3
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=12.5 Irms=2.21565 Rser=0.055 Lser=0
SYMBOL diode 176 256 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL res 416 256 R0
SYMATTR InstName R5
SYMATTR Value 47K
SYMBOL res 480 64 R0
SYMATTR InstName R9
SYMATTR Value 10K
SYMBOL res 656 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 150K
SYMBOL res 480 352 R0
SYMATTR InstName R12
SYMATTR Value 39K
SYMBOL voltage -576 128 R0
WINDOW 3 -65 159 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 1 0.25 0.001 0.002 2 5)
SYMATTR InstName V3
SYMBOL res -528 128 R0
SYMATTR InstName R13
SYMATTR Value 1K
SYMBOL bi -304 272 R0
WINDOW 3 485 216 Right 2
WINDOW 0 -39 -6 Left 2
SYMATTR Value I=V(Vswitch) * I(I1) + white(time * 2e3)/1000
SYMATTR InstName B1
SYMBOL current -576 352 R0
WINDOW 123 -46 -3 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 -30 137 Left 2
WINDOW 0 11 -3 Left 2
SYMATTR Value2 AC 1
SYMATTR Value SINE(0 0.002 60)
SYMATTR InstName I1
SYMBOL res -528 336 R0
SYMATTR InstName R14
SYMATTR Value 1K
SYMBOL cap -320 432 R0
WINDOW 0 41 22 Left 2
WINDOW 3 41 46 Left 2
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL res -400 320 R0
SYMATTR InstName R15
SYMATTR Value 150
SYMBOL diode -144 224 R0
WINDOW 0 34 32 Left 2
WINDOW 3 31 56 VRight 2
SYMATTR InstName D2
SYMATTR Value D1N4001
SYMBOL diode -160 416 R180
WINDOW 0 35 36 Left 2
WINDOW 3 2 55 VRight 2
SYMATTR InstName D3
SYMATTR Value D1N4001
SYMBOL cap 96 336 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 10n
SYMBOL res 368 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL cap 112 96 R0
WINDOW 3 41 31 Left 2
SYMATTR Value 0.1µ
SYMATTR InstName C2
SYMBOL cap 656 80 R0
WINDOW 3 41 30 Left 2
SYMATTR Value 0.1µ
SYMATTR InstName C4
SYMBOL res 832 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 864 336 R0
SYMATTR InstName R7
SYMATTR Value 330
SYMBOL LED 864 272 R0
SYMATTR InstName D4
SYMBOL TL431 -400 432 R0
WINDOW 0 39 38 Left 2
WINDOW 3 27 10 Left 2
SYMATTR InstName U4
SYMBOL TMBT3906 816 256 M180
SYMATTR InstName U5
TEXT -224 96 Left 2 !.tran 0 5 0 startup
TEXT -224 120 Left 2 ;.ac dec 10 .6 6000
